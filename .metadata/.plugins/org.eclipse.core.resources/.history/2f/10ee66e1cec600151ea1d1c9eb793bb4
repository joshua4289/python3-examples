# install using pip:        pip install scikit-image
#

import numpy as np
import matplotlib.pyplot as plt
from skimage import data
coins = data.coins()
histo = np.histogram(coins, bins=np.arange(0, 256))
hist, bin_edges = np.histogram(coins, bins=np.arange(0, 25))

#plt.bar(bin_edges[:-1], hist, width = 1)
#plt.xlim(min(bin_edges), max(bin_edges))
from skimage.feature import canny
edges = canny(coins/255.)
#plt.imshow(edges)
#plt.show()   

from scipy import ndimage
fill_coins = ndimage.binary_fill_holes(edges)
#plt.imshow(fill_coins)
#plt.show()   

markers = np.zeros_like(coins)
markers[coins < 30] = 1
markers[coins > 150] = 2
#plt.imshow(markers)
#plt.show()   

from skimage.filters import sobel
elevation_map = sobel(coins)
#plt.imshow(elevation_map)
#plt.show()   

from skimage.morphology import watershed
segmentation = watershed(elevation_map, markers)

segmentation = ndimage.binary_fill_holes(segmentation - 2)
#plt.imshow(segmentation)
#plt.show()   

labeled_coins, numberOfObjectsFound = ndimage.label(segmentation)
print numberOfObjectsFound
labeled_coins, numberOfObjectsFound = ndimage.measurements.label(segmentation)
print numberOfObjectsFound
plt.imshow(labeled_coins)
plt.show()   
